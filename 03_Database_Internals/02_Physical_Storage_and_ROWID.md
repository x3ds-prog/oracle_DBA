# Модуль 3: Внутреннее устройство базы данных

## Урок 2: Физическое хранение и `ROWID`

Как системный администратор, вы знаете, что у каждого файла в файловой системе есть **`inode`** — уникальный идентификатор, который указывает на физическое местоположение данных файла на диске. Зная `inode`, система может получить доступ к файлу напрямую, минуя долгий поиск по имени.

В Oracle существует очень похожая концепция для строк в таблицах. Она называется `ROWID`.

### Что такое `ROWID`?

`ROWID` — это **псевдоколонка**, которая есть у каждой строки в каждой таблице Oracle (за некоторыми исключениями, которые нас пока не касаются). `ROWID` представляет собой **физический адрес** строки на диске. Он однозначно указывает, в каком файле данных, в каком блоке внутри этого файла и в какой строке внутри этого блока хранятся данные.

Это самый быстрый способ доступа к строке, который только существует в Oracle.

### Эксперимент: "Покажи мне `inode`"

`ROWID` не является частью таблицы в привычном смысле, но вы можете его выбрать в любом `SELECT` запросе, как если бы это была обычная колонка.

Давайте посмотрим на `ROWID` для наших сотрудников:

```sql
SELECT
    rowid,
    id,
    name,
    salary
FROM employees;
```

**Результат (может отличаться у вас):**
```
ROWID                    ID NAME                                                   SALARY
------------------ ---------- -------------------------------------------------- ----------
AAAVi2AABAAALy/AAA        100 Alice                                                 75000
```
Вы увидите странную на вид строку `AAAVi2AABAAALy/AAA`. Это и есть закодированный физический адрес строки. Он состоит из нескольких частей:
-   ID объекта данных (нашей таблицы).
-   ID файла данных, в котором хранится строка.
-   Номер блока в этом файле.
-   Номер строки внутри блока.

Вам не нужно уметь расшифровывать `ROWID` вручную. Главное — понимать его суть.

> **Для админа Linux: Аналогии**
>
> -   **`ROWID`** — это **`inode`** для строки таблицы.
> -   **Блок данных Oracle** — это как блок в файловой системе (`ext4`, `xfs`). Минимальная единица дискового пространства, которой оперирует база данных.
> -   **Файл данных Oracle** — это как раздел диска (`/dev/sda1`), в котором лежат блоки.

### Почему `ROWID` важен?

Понимание `ROWID` — ключ к пониманию производительности запросов. Когда вы выполняете запрос с фильтром, например `SELECT * FROM employees WHERE id = 100`, у Oracle есть два основных пути:

1.  **Полное сканирование таблицы (Full Table Scan):** Прочитать **все** блоки данных таблицы один за другим и проверить каждую строку на соответствие условию `id = 100`.
    *   **Аналогия:** `cat /etc/passwd | grep 'alice'`

2.  **Доступ по `ROWID`:** Если у Oracle есть способ мгновенно узнать `ROWID` для строки с `id = 100`, он может перейти напрямую к нужному блоку и прочитать только его.
    *   **Аналогия:** `debugfs -R 'cat <inode_number>' /dev/sda1` (утрированно)

Первый способ эффективен для маленьких таблиц, но катастрофически медленный для больших. Второй — практически мгновенный.

Но откуда Oracle может быстро узнать `ROWID` для нужного значения? Из **индекса**.

### Что дальше?

Мы познакомились с физическим адресом строки. В следующем уроке мы создадим наш первый **индекс** — специальную структуру данных, которая хранит отсортированные значения колонки и соответствующие им `ROWID`, что позволяет базе данных выполнять молниеносный поиск.
